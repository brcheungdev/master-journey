#  My notes
- This folder contains my notes, thoughts and learning summaries during my master's degree study.
- The main topics include: **Fundamentals of Information Network(情報ネットワーク概論)**.
- Instructor:Prof. Seiichiro Aoki (青木 成一郎)

# Lecture 9: STP (Spanning Tree), Routing Basics, Static/Dynamic Routing, RIP & Count-to-Infinity  
# 情報ネットワーク概論 第9回：スパニングツリー／経路制御の基礎／静的・動的ルーティング／RIPと無限カウント

---

## ⚪ Lecture Overview 
- **STP（Spanning Tree Protocol）**：为避免二层环路导致的**广播风暴**，通过**根桥/端口角色/路径代价**自动屏蔽冗余链路；链路/端口故障时可**自动切换**（传统 STP 收敛需数十秒；**RSTP** 将其降到数秒级）。  
- **Routing 基础**：路由器依据**路由表**（目的网络 → 下一跳）逐跳转发；路由表需保持**正确信息**。  
- **静态路由 vs 动态路由**：静态=手工配置，变更/故障需人工维护；动态=路由协议**自动**学习/更新（定期交换信息）。  
- **互联网与路由协议**：互联网可视为多个 **AS（Autonomous System，自治系统）** 的集合；**IGP**（RIP/RIP2/OSPF/IS-IS）用于 AS 内，**EGP/BGP** 用于 AS 间。  
- **RIP**：距离向量型 IGP，**度量=跳数**，**30s 周期更新**、**最大跳数=16（≥16 视为不可达）**、超时/垃圾回收定时器；**无穷计数（Count-to-Infinity）** 问题与其抑制。  

---

## ⚪ Lecture Content 

### 1) Spanning Tree Protocol（STP）/ 生成树协议：避免二层环路
**问题与目标 / Problem & Goal**  
- **广播风暴（Broadcast Storm）**：在交换网络中存在**二层环路**时，广播帧/未知单播会**无限循环**，造成链路拥塞与设备过载。  
- **STP 作用**：自动计算**无环拓扑（生成树）**，对冗余端口置为**阻塞**，仅保留无环的转发表，从而防止广播风暴。

**核心要素 / Core Elements**  
- **Bridge ID（桥 ID）**：由优先级+MAC 等决定；**最小**的成为**Root Bridge（根桥）**。  
- **Path Cost（路径代价）**：链路速率对应的花费；自根桥出发到各桥的**总代价最小**路径被选择。  
- **端口角色 / Port Roles**  
  - **Root Port（根端口）**：每台非根桥**指向根桥的最优路径**上的端口。  
  - **Designated Port（指定端口/代表端口）**：在每一段链路上，**负责该段转发**的端口（通常在代价/Bridge ID 比较下胜出）。  
  - **Blocking/Disabled Port（阻塞端口/无效端口）**：既非 Root Port 也非 Designated Port 的端口，被**禁用转发**以打破环路。

**故障与收敛 / Failure & Convergence**  
- 当**链路断开**或**端口故障**导致通信中断时，STP 将**重新计算代价**，把原阻塞端口**切换**为 Root/Designated 等角色以恢复连通。  
- **传统 STP 收敛需数十秒**；为改进此问题，出现了**RSTP（Rapid STP）** 等快速收敛标准（数秒级）。

---

### 2) Routing 基础：路由表与逐跳转发
- 互联网由多个网络通过**路由器**互联而成。  
- 路由器需要**查路由表**（Destination Network → Next Hop）以转发到**正确的目的地**；表项必须**准确**。  
- 转发过程：检查报文**目的 IP** → 与路由表比对 → 决定**下一跳路由器或直连主机** → 逐跳转发（**“接力式”/bucket-brigade**）。  
- 每个节点**只需知道下一跳**；“两跳以外”的路径细节**无需感知**。 
---

### 3) 静态路由 vs 动态路由
**静态路由（Static Routing）**  
- **方法**：在路由器/主机上**固定配置**到各目的网络的下一跳。  
- **优点**：无需配置路由协议；适合**路由器数量少**的场景。  
- **缺点**：网络新增/删除、链路/设备故障时需要**人工修改**；**无法自动绕行**，运维负担大。 

**动态路由（Dynamic Routing）**  
- **方法**：由**路由协议**在路由器之间**自动传播/更新**路由信息（定期互换消息）。  
- **优点**：拓扑变化或故障时**自动更新**并**选择绕行路径**，大幅降低运维负担；适合**大规模**网络。  
- **缺点**：需要配置/维护路由协议（不同协议复杂度不同）。

---

### 4) 互联网与路由协议：AS、IGP 与 EGP
- **AS（Autonomous System, 自治系统）**：在**相同路由策略/管理域**下的一组路由器（如高校/研究机构/ISP）。  
- **IGP（Interior Gateway Protocol）**：用于**AS 内部**的路由协议 —— **RIP/RIP2**（小规模）、**OSPF**（中大型）、**IS-IS**（IP 早期祖先/同类思想）。  
- **EGP/BGP**：用于**AS 间**的路由选择与策略控制（Internet 采用 **BGP**）。
---

### 5) 动态路由算法类型
- **Distance Vector（距离向量型）**：如 **RIP/RIP2**；路由器向邻居**通告（距离, 方向）**，据此选择最小代价路径。  
- **Link State（链路状态型）**：如 **OSPF**；路由器向区域内**泛洪**本地链路状态，**每台路由器**在本地运行 SPF 计算最短路。 

---

### 6) RIP（Routing Information Protocol）
**概览 / Overview**  
- 历史悠久的 **IP 路由协议**（源自 ARPANET 早期思想）。  
- **度量（Metric）= 跳数（Hop Count）**；以**UDP 广播**向相邻路由器通告路由信息。  
- 通过“距离”把握网络拓扑，属于**距离向量算法**。

**基本行为 / Basic Behavior**  
- 每**经过 1 个路由器**，跳数 **+1**。  
- **周期更新**：默认**每 30 s**向邻居通告路由；收到通告后将**发送方作为下一跳**、**跳数+1**，并**更新路由表**（若更优或原路由失效）。  
- **最大度量=16**：当度量 ≥16 时视为**不可达**，相应目的**丢弃**。

**定时器 / Timers**  
- **Route Timeout**：若**180 s** 未收到某邻居的定期更新，则判定该邻居或其网络**失效**，把相关路由标成**不可达（metric=16）**并通告出去，同时启动**垃圾回收计时器**。  
- **Garbage Collection**：**120 s** 到期后，将该**失效路由从路由表删除**。 

**优点 / Pros**  
- 实现简单、部署广、许多服务器 OS（如 Linux）**内置**支持；在**小型网络**中仍被广泛使用。

---

### 7) RIP 报文格式（简）
```
Operation | Version | Address Family Identifier | IP Address | Metric
   ... up to 25 route entries per RIP message ...
```
- **Operation**：请求/响应。
- **Version**：版本号。
- **Address Family**：地址族标识。
- **IP Address**：目的网络地址。
- **Metric**：1～16（**16=不可达**）。
- **每条报文**可携带**最多约 25** 条路由项。
 
---
### 8) 无穷计数（Count-to-Infinity）问题
**现象 / Symptom**
- 当某条链路/网络失效后，邻居路由器之间由于距离向量的**渐进传播**，会把对方的通告**误认为可达**，导致该目的的度量**不断增大**（在 RIP 中最高涨到 **16**）。
- 虽有 **16 上限**避免“真正无穷”，但在此过程中会有**无效路由反复被转发/更新**v，浪费带宽与收敛时间。

**逐步过程（示意） / Step-by-step**
```
(1) 链路Down：R1 立即把 192.168.0.0/24 从表中删除
(2) R1 仍可能从 R2 收到“到 192.168.0.0/24 可达”的更新
(3) R1 依据 R2 的更新，误将该网段重新加入（度量更大）
(4) R1 把该更新再通告给 R2/R3 ...
(5) R2 又据 R1 的更新提高度量并通告 ...
(6) 如此往复，度量逐步攀升，直到 16 → 标记不可达
```
注：讲义中以 R1/R2/R3 的交互说明该过程；RIP 通过**“最大跳数=16”**限制发散，但仍会造成一段时间的无谓广播与表项震荡。
 
---
## Key Points
- **STP** 通过**根桥/路径代价/端口角色**计算无环拓扑，**阻塞冗余端口**以抑制**广播风暴**；故障时可自动切换，传统 STP 收敛**数十秒**，**RSTP** 降至**数秒**。
- **路由器逐跳转发**：仅需知道**下一跳**；路由表准确性决定转发正确性。
- **静态路由**：配置简单但**不随拓扑自适应**；**动态路由**：协议定期**交换信息**，可**自动绕行**，适合大规模网络。
- **AS/IGP/EGP**：AS 内常用**RIP/RIP2/OSPF/IS-IS**；AS 间用**BGP**。
- **RIP**：**30 s** 定期更新、**度量=跳数**、**最大=16**；**180 s** 超时标记失效、**120 s **垃圾回收删除；存在**无穷计数问题**（以上限 16 抑制但仍有收敛开销）。
- 
---

## ※※ Supplementary Cheat Sheets | 速查单

### STP & RIP Quick Reference
- [STP Port Roles & Convergence | STP 端口角色与收敛流程](./figs/lecture09_stp_port_roles.md)  
  *生成树协议的根桥选举、端口角色、收敛过程与定时器*

- [RIP Timers & Metrics | RIP 定时器与度量](./figs/lecture09_rip_timers_metrics.md)  
  *RIP 协议的定时器、最大跳数、无穷计数问题与报文字段*


